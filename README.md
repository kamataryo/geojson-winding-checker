# GeoJSON Winding 確認ツール

画像上にGeoJSONデータを重ね合わせて表示し、座標の順序（winding order）を視覚的に確認できるWebアプリケーションです。
https://kamataryo.github.io/geojson-winding-checker/

## 概要

このツールは、GeoJSONファイルの座標データを画像のピクセル座標として解釈し、点・線・面を画像上に重ね描画します。線や面の場合は、各ノードに順番（1, 2, 3, ...）をラベルとして表示することで、座標の順序を視覚的に確認できます。

## 主な機能

- **同時ドラッグ&ドロップ対応**: 画像ファイルとGeoJSONファイルを同時または個別にドロップして読み込み
- **複数ファイル対応**: 複数の画像や複数のGeoJSONがドロップされた場合、それぞれの最初のファイルを自動選択
- **ファイルプレビュー**: 画像ドロップ時に小さなプレビューを表示、GeoJSONドロップ時に内容をテキストエリアに表示
- **ファイル置き換え**: 同じ種類のファイルを再度ドロップすると既存のファイルを置き換え
- **重ね合わせ実行**: 両ファイルがドロップされた状態で「重ね合わせ実行」ボタンを押下して処理を開始
- **重ね描画**: GeoJSONの座標を画像のピクセル座標として重ね表示
- **ノード番号表示**: 線・面の各頂点に順序番号を表示（大きなフォントサイズで視認性向上）
- **ノード可視化**: 各ノードに色付きの円を表示して位置を明確化
- **ノード数フィルタ**: 指定したノード数以下のfeatureを除外して表示
- **スマートダウンロード**: 元の画像ファイル名を基にした「{画像名}_overlay.png」形式でダウンロード

## 技術仕様

### 使用技術
- **HTML5 Canvas**: 画像とGeoJSONの描画
- **Webpack**: モジュールバンドラー

### サポートファイル形式
- **画像**: PNG, JPEG, GIF, WebP等（ブラウザがサポートする形式）
- **GeoJSON**: .geojson, .json拡張子のファイル

### ブラウザ要件
- HTML5 Canvas対応ブラウザ
- File API対応ブラウザ
- ES6対応ブラウザ

## セットアップ(開発者向け)

### 前提条件
- Node.js (LTS)
- npm

### インストール
```bash
# 依存関係のインストール
npm install
```

### 開発サーバーの起動
```bash
# 開発サーバーを起動（ブラウザが自動で開きます）
npm run dev
```

### プロダクションビルド
```bash
# 本番用ビルド（distフォルダに出力）
npm run build
```

## 使用方法

1. **アプリケーションを開く**
   - 開発サーバーを起動するか、ビルドしたファイルをブラウザで開く

2. **ファイルをドロップ**
   - **個別ドロップ**: 画像ファイルとGeoJSONファイルを別々にドロップ
   - **同時ドロップ**: 画像ファイルとGeoJSONファイルを同時に選択してドロップ
   - **複数ファイル対応**: 複数の画像や複数のGeoJSONがある場合、それぞれの最初のファイルが自動選択される
   - **画像ファイル**（PNG, JPEG等）をドロップエリアにドラッグ&ドロップ
     - ドロップ後、下部に小さなプレビューが表示される
     - ファイル名も表示される
   - **GeoJSONファイル**（.geojson, .json）をドロップエリアにドラッグ&ドロップ
     - ドロップ後、テキストエリアにGeoJSONの内容が表示される
     - ファイル名も表示される

3. **ファイルの置き換え**
   - 同じ種類のファイルを再度ドロップすると、既存のファイルが置き換えられる
   - ステータスアイコン（⭕→✅）でファイルの読み込み状態を確認できる

4. **重ね合わせ実行**
   - 両方のファイルがドロップされると「重ね合わせ実行」ボタンが有効になる
   - ボタンをクリックして重ね合わせ処理を開始

5. **結果の確認**
   - 画像上にGeoJSONデータが重ね描画される
   - 線・面の場合は各ノードに番号が表示される
   - ノードは色付きの円で視覚的に強調表示される

6. **フィルタ機能の使用**
   - 「ノード数フィルタ」でノード数とフィルタ条件を指定
   - 数値入力欄でノード数を指定
   - ドロップダウンで「以下」または「以上」を選択
   - 指定した条件に該当するfeatureが除外される
   - リアルタイムで表示が更新される
   - 例：「3以下」を選択すると、3ノード以下のfeatureが非表示になる
   - 例：「5以上」を選択すると、5ノード以上のfeatureが非表示になる

7. **画像の保存**
   - 「画像をダウンロード」ボタンで結果をPNG形式で保存

8. **リセット**
   - 「リセット」ボタンで初期画面に戻る
   - すべてのファイルとプレビューがクリアされる

## 対応するGeoJSONジオメトリタイプ

### Point（点）
- 赤色の円で表示
- ラベル「1」を表示

### LineString（線）
- 青色の線で表示
- 各頂点に青色の小さな円
- 各頂点にノード番号（1, 2, 3, ...）を表示

### Polygon（面）
- 緑色の半透明な面で表示
- 外側のリングの各頂点に緑色の小さな円
- 各頂点にノード番号を表示（最後の重複点は除外）
- 内側のリング（穴）にも対応

### Multi系ジオメトリ
- **MultiPoint**: 複数の点を表示
- **MultiLineString**: 複数の線を表示
- **MultiPolygon**: 複数の面を表示

## プロジェクト構造

```
geojson-winding-checker/
├── package.json              # プロジェクト設定・依存関係
├── webpack.config.js         # Webpack設定
├── src/
│   ├── index.html           # HTMLテンプレート
│   ├── index.js             # メインJavaScriptファイル
│   └── styles.css           # スタイルシート
├── dist/                    # ビルド出力先（自動生成）
└── README.md               # このファイル
```

## 座標系について

このツールは、GeoJSONの座標値を**画像のピクセル座標**として直接解釈します。

- X座標: 画像の左端からの距離（ピクセル）
- Y座標: 画像の上端からの距離（ピクセル）

地理座標系（緯度経度）を使用する場合は、事前に画像のピクセル座標系に変換する必要があります。

## エラーハンドリング

- サポートされていないファイル形式の場合: アラートでエラー表示
- 画像ファイルの読み込みに失敗した場合: アラートでエラー表示
- GeoJSONファイルの読み込みに失敗した場合: アラートでエラー表示
- GeoJSONの解析に失敗した場合: アラートでエラー表示
- 重ね合わせ実行時に必要なファイルが不足している場合: アラートでエラー表示

## カスタマイズ

### 色の変更
`src/index.js`の以下の部分で色を変更できます：
- Point: `#e74c3c` (赤)
- LineString: `#3498db` (青)
- Polygon: `#2ecc71` (緑)

### ラベルスタイル
`drawLabel`メソッドでラベルのフォント、サイズ、位置を調整できます。

## ライセンス

MIT License

## 作者

kamataryo <ryo@kamataworks.com>
